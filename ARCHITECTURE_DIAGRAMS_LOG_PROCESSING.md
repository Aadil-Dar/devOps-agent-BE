# System Architecture Diagrams - Log Processing

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Frontend Dashboard                          â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Process Logs   â”‚                    â”‚  Health Check    â”‚       â”‚
â”‚  â”‚   Button        â”‚                    â”‚  Auto-refresh    â”‚       â”‚
â”‚  â”‚  (Manual/Cron)  â”‚                    â”‚   (30 sec)       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                          â”‚
            â”‚ POST /process-logs                       â”‚ GET /healthCheck
            â”‚                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Spring Boot Backend                            â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  DevOpsInsightController    â”‚    â”‚                          â”‚  â”‚
â”‚  â”‚  - /process-logs (POST)     â”‚    â”‚                          â”‚  â”‚
â”‚  â”‚  - /healthCheck (GET)       â”‚    â”‚                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                          â”‚  â”‚
â”‚         â”‚              â”‚             â”‚                          â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚             â”‚                          â”‚  â”‚
â”‚  â”‚ LogProcessing   â”‚   â”‚             â”‚                          â”‚  â”‚
â”‚  â”‚    Service      â”‚   â”‚             â”‚   DevOpsInsight         â”‚  â”‚
â”‚  â”‚                 â”‚   â”‚             â”‚      Service            â”‚  â”‚
â”‚  â”‚ â€¢ Fetch Logs    â”‚   â”‚             â”‚                          â”‚  â”‚
â”‚  â”‚ â€¢ Filter/Group  â”‚   â”‚             â”‚  â€¢ Read Cache           â”‚  â”‚
â”‚  â”‚ â€¢ Embeddings    â”‚   â”‚             â”‚  â€¢ Predictions          â”‚  â”‚
â”‚  â”‚ â€¢ AI Summary    â”‚   â”‚             â”‚  â€¢ Risk Analysis        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚             â”‚                          â”‚  â”‚
â”‚       â”‚    â”‚      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                          â”‚  â”‚
â”‚       â”‚    â”‚      â”‚  Metric     â”‚    â”‚                          â”‚  â”‚
â”‚       â”‚    â”‚      â”‚ Processing  â”‚    â”‚                          â”‚  â”‚
â”‚       â”‚    â”‚      â”‚  Service    â”‚    â”‚                          â”‚  â”‚
â”‚       â”‚    â”‚      â”‚  (@Async)   â”‚    â”‚                          â”‚  â”‚
â”‚       â”‚    â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                          â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚    â”‚           â”‚             â”‚
        â”‚    â”‚           â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           AWS Services                               â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ CloudWatch   â”‚  â”‚ CloudWatch  â”‚  â”‚       DynamoDB           â”‚  â”‚
â”‚  â”‚    Logs      â”‚  â”‚   Metrics   â”‚  â”‚                          â”‚  â”‚
â”‚  â”‚              â”‚  â”‚             â”‚  â”‚  â€¢ devops-log-summaries  â”‚  â”‚
â”‚  â”‚ â€¢ /ecs/...   â”‚  â”‚ â€¢ EC2/CPU   â”‚  â”‚  â€¢ devops-log-embeddings â”‚  â”‚
â”‚  â”‚ â€¢ Filters    â”‚  â”‚ â€¢ Network   â”‚  â”‚  â€¢ devops-metric-snapshotsâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â€¢ devops-predictions    â”‚  â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Ollama AI Services                          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  nomic-embed-text   â”‚         â”‚      llama3.2        â”‚        â”‚
â”‚  â”‚  (Embeddings)       â”‚         â”‚   (Summarization)    â”‚        â”‚
â”‚  â”‚                     â”‚         â”‚                      â”‚        â”‚
â”‚  â”‚  768-dim vectors    â”‚         â”‚  Text generation     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow - Process Logs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend   â”‚
â”‚   Trigger   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. POST /process-logs?projectId=X
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             LogProcessingService.processLogs()                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ Step 1: Fetch Logs (2-5 sec)
       â”‚    â”‚
       â”‚    â”œâ”€â–º CloudWatch Logs Client
       â”‚    â”‚    â””â”€â–º FilterLogEvents (ERROR, WARN, EXCEPTION)
       â”‚    â”‚
       â”‚    â””â”€â–º Returns: List<FilteredLogEvent>
       â”‚
       â”œâ”€ Step 2: Process & Group (<1 sec)
       â”‚    â”‚
       â”‚    â”œâ”€â–º Extract service, severity, error signature
       â”‚    â”œâ”€â–º Group by key (service#error#severity)
       â”‚    â”œâ”€â–º Calculate trends (increasing/decreasing)
       â”‚    â”‚
       â”‚    â””â”€â–º Returns: List<LogSummary>
       â”‚
       â”œâ”€ Step 3: Generate Embeddings (3-5 sec) ğŸ”¥ PARALLEL
       â”‚    â”‚
       â”‚    â”œâ”€â–º ExecutorService (5 threads)
       â”‚    â”‚    â”‚
       â”‚    â”‚    â”œâ”€â–º Thread 1: Embed summary 1
       â”‚    â”‚    â”œâ”€â–º Thread 2: Embed summary 2
       â”‚    â”‚    â”œâ”€â–º Thread 3: Embed summary 3
       â”‚    â”‚    â”œâ”€â–º Thread 4: Embed summary 4
       â”‚    â”‚    â””â”€â–º Thread 5: Embed summary 5
       â”‚    â”‚
       â”‚    â”œâ”€â–º Ollama POST /api/embeddings
       â”‚    â”‚    {model: "nomic-embed-text", prompt: "..."}
       â”‚    â”‚
       â”‚    â””â”€â–º Returns: List<LogEmbedding> (768-dim vectors)
       â”‚
       â”œâ”€ Step 4: Generate AI Summary (1-2 sec)
       â”‚    â”‚
       â”‚    â”œâ”€â–º Top 10 critical errors â†’ Prompt
       â”‚    â”œâ”€â–º Ollama POST /api/generate
       â”‚    â”‚    {model: "llama3.2", prompt: "..."}
       â”‚    â”‚
       â”‚    â””â”€â–º Returns: String summary
       â”‚
       â”œâ”€ Step 5: Save to DynamoDB (<1 sec) ğŸ”¥ PARALLEL
       â”‚    â”‚
       â”‚    â”œâ”€â–º CompletableFuture 1: Save LogSummaries
       â”‚    â”‚    â””â”€â–º DynamoDB.putItem() Ã— N
       â”‚    â”‚
       â”‚    â””â”€â–º CompletableFuture 2: Save LogEmbeddings
       â”‚         â””â”€â–º DynamoDB.putItem() Ã— N
       â”‚
       â””â”€ Step 6: Trigger Async Metrics (non-blocking)
            â”‚
            â””â”€â–º MetricProcessingService.processMetricsAsync()
                 â””â”€â–º Returns immediately, processes in background
       
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Return Response                             â”‚
â”‚                                                               â”‚
â”‚  {                                                            â”‚
â”‚    totalLogsProcessed: 1250,                                 â”‚
â”‚    summariesCreated: 12,                                     â”‚
â”‚    embeddingsCreated: 12,                                    â”‚
â”‚    aiSummary: "...",                                         â”‚
â”‚    overallSeverity: "MEDIUM",                                â”‚
â”‚    topErrors: [...],                                         â”‚
â”‚    stats: {totalDurationMs: 8500}                            â”‚
â”‚  }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow - Health Check

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend   â”‚
â”‚  Dashboard  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ GET /healthCheck?projectId=X
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          DevOpsInsightService.performHealthCheck()             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ Step 1: Read Log Summaries (<50 ms)
       â”‚    â”‚
       â”‚    â””â”€â–º DynamoDB Query
       â”‚         â””â”€â–º devops-log-summaries (projectId = X)
       â”‚
       â”œâ”€ Step 2: Read Metrics (<50 ms)
       â”‚    â”‚
       â”‚    â””â”€â–º DynamoDB Query
       â”‚         â””â”€â–º devops-metric-snapshots (projectId = X)
       â”‚
       â”œâ”€ Step 3: Calculate Risk (local computation)
       â”‚    â”‚
       â”‚    â”œâ”€â–º Error counts
       â”‚    â”œâ”€â–º Trend analysis
       â”‚    â”œâ”€â–º Metric thresholds (CPU > 80%)
       â”‚    â”‚
       â”‚    â””â”€â–º Returns: Risk Level (LOW/MEDIUM/HIGH/CRITICAL)
       â”‚
       â”œâ”€ Step 4: Generate Predictions (local computation)
       â”‚    â”‚
       â”‚    â”œâ”€â–º Failure likelihood (0.0 - 1.0)
       â”‚    â”œâ”€â–º Timeframe estimation
       â”‚    â”œâ”€â–º Root cause analysis
       â”‚    â”‚
       â”‚    â””â”€â–º Returns: PredictionResult
       â”‚
       â””â”€ Step 5: Build Response
            â”‚
            â””â”€â–º DevOpsHealthCheckResponse
       
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Return Response                             â”‚
â”‚                                                               â”‚
â”‚  {                                                            â”‚
â”‚    riskLevel: "MEDIUM",                                      â”‚
â”‚    summary: "...",                                           â”‚
â”‚    recommendations: [...],                                   â”‚
â”‚    failureLikelihood: 0.42,                                 â”‚
â”‚    rootCause: "...",                                        â”‚
â”‚    errorCount: 45,                                          â”‚
â”‚    warningCount: 102                                        â”‚
â”‚  }                                                            â”‚
â”‚                                                               â”‚
â”‚  Response Time: < 100ms                                      â”‚
â”‚  AI Tokens Used: 0                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Async Metric Processing (Background)

```
Triggered by /process-logs, runs independently

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      MetricProcessingService.processMetricsAsync()          â”‚
â”‚                    @Async Method                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ Step 1: Discover EC2 Instances
       â”‚    â”‚
       â”‚    â””â”€â–º EC2 Client: DescribeInstances
       â”‚         â””â”€â–º Filter: state=running
       â”‚         â””â”€â–º Returns: List<instanceId>
       â”‚
       â”œâ”€ Step 2: Fetch Metrics in Parallel ğŸ”¥
       â”‚    â”‚
       â”‚    â””â”€â–º For each instance:
       â”‚         â””â”€â–º For each metric (CPU, NetworkIn, NetworkOut):
       â”‚              â”‚
       â”‚              â”œâ”€â–º CompletableFuture 1: Get CPUUtilization
       â”‚              â”œâ”€â–º CompletableFuture 2: Get NetworkIn
       â”‚              â”œâ”€â–º CompletableFuture 3: Get NetworkOut
       â”‚              â”‚
       â”‚              â””â”€â–º CloudWatch.getMetricStatistics()
       â”‚
       â”œâ”€ Step 3: Save to DynamoDB
       â”‚    â”‚
       â”‚    â””â”€â–º DynamoDB.putItem() Ã— N metrics
       â”‚         â””â”€â–º devops-metric-snapshots
       â”‚
       â””â”€ Step 4: Complete
            â”‚
            â””â”€â–º Log: "Collected N metrics"

Timeline:
0ms     - Process logs starts
8500ms  - Process logs completes (returns response)
8501ms  - Metric processing starts (async)
15000ms - Metric processing completes (background)
```

---

## Embedding Generation Flow

```
Input: LogSummary
â”‚
â”œâ”€ Service: eptBackendApp
â”œâ”€ Error: ConnectionTimeoutException  
â”œâ”€ Severity: ERROR
â”œâ”€ Occurrences: 23
â””â”€ Sample: "Connection timeout after 30s..."

       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Create Embedding Text                  â”‚
â”‚                                           â”‚
â”‚   "Service: eptBackendApp |              â”‚
â”‚    Error: ConnectionTimeoutException |    â”‚
â”‚    Severity: ERROR |                      â”‚
â”‚    Occurrences: 23 |                      â”‚
â”‚    Sample: Connection timeout after..."  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   POST to Ollama                          â”‚
â”‚   /api/embeddings                         â”‚
â”‚                                           â”‚
â”‚   {                                       â”‚
â”‚     "model": "nomic-embed-text",         â”‚
â”‚     "prompt": "Service: eptBackendApp..." â”‚
â”‚   }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ollama Response                         â”‚
â”‚                                           â”‚
â”‚   {                                       â”‚
â”‚     "embedding": [                        â”‚
â”‚       0.1234, -0.5678, 0.9012, ...      â”‚
â”‚       ... (768 dimensions total)          â”‚
â”‚     ]                                     â”‚
â”‚   }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Create LogEmbedding Entity             â”‚
â”‚                                           â”‚
â”‚   LogEmbedding {                         â”‚
â”‚     projectId: "my-project",             â”‚
â”‚     embeddingId: "summary123#emb",       â”‚
â”‚     embedding: [0.1234, -0.5678, ...],  â”‚
â”‚     errorSignature: "ConnectionTimeout",  â”‚
â”‚     severity: "ERROR",                    â”‚
â”‚     timestamp: 1707523200000              â”‚
â”‚   }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Save to DynamoDB                        â”‚
â”‚   devops-log-embeddings                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## DynamoDB Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           devops-log-summaries                      â”‚
â”‚                                                      â”‚
â”‚  PK: projectId         SK: summaryId                â”‚
â”‚  â”œâ”€ service                                         â”‚
â”‚  â”œâ”€ errorSignature                                  â”‚
â”‚  â”œâ”€ severity                                        â”‚
â”‚  â”œâ”€ occurrences                                     â”‚
â”‚  â”œâ”€ trendScore                                      â”‚
â”‚  â””â”€ sampleMessage                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ 1:1 relationship
                   â”‚ (linked by summaryId)
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           devops-log-embeddings                     â”‚
â”‚                                                      â”‚
â”‚  PK: projectId         SK: embeddingId              â”‚
â”‚  â”œâ”€ summaryId (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”œâ”€ embedding (768-dim)     â”‚                       â”‚
â”‚  â”œâ”€ errorSignature          â”‚                       â”‚
â”‚  â”œâ”€ severity                â”‚                       â”‚
â”‚  â””â”€ summaryText             â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         devops-metric-snapshots                     â”‚
â”‚                                                      â”‚
â”‚  PK: projectId         SK: timestamp                â”‚
â”‚  â”œâ”€ serviceName (instanceId)                        â”‚
â”‚  â”œâ”€ metricName (CPUUtilization, etc)               â”‚
â”‚  â”œâ”€ value                                           â”‚
â”‚  â”œâ”€ unit                                            â”‚
â”‚  â””â”€ dimensions                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        devops-prediction-results                    â”‚
â”‚                                                      â”‚
â”‚  PK: projectId         SK: timestamp                â”‚
â”‚  â”œâ”€ riskLevel                                       â”‚
â”‚  â”œâ”€ summary                                         â”‚
â”‚  â”œâ”€ recommendations                                 â”‚
â”‚  â”œâ”€ failureLikelihood                              â”‚
â”‚  â”œâ”€ rootCause                                       â”‚
â”‚  â”œâ”€ errorCount                                      â”‚
â”‚  â””â”€ warningCount                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Thread Pool Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Main Application Thread                     â”‚
â”‚                                                      â”‚
â”‚  POST /process-logs                                 â”‚
â”‚    â”‚                                                 â”‚
â”‚    â”œâ”€â–º Fetch Logs (sequential)                     â”‚
â”‚    â”œâ”€â–º Process Logs (sequential)                   â”‚
â”‚    â”‚                                                 â”‚
â”‚    â”œâ”€â–º Generate Embeddings â”€â”€â”€â”€â”                   â”‚
â”‚    â”‚                            â”‚                   â”‚
â”‚    â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚                â”‚  EMBEDDING_EXECUTOR        â”‚  â”‚
â”‚    â”‚                â”‚  (FixedThreadPool: 5)      â”‚  â”‚
â”‚    â”‚                â”‚                             â”‚  â”‚
â”‚    â”‚                â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚    â”‚                â”‚  â”‚Thd 1â”‚ â”‚Thd 2â”‚ â”‚Thd 3â”‚ â”‚  â”‚
â”‚    â”‚                â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚    â”‚                â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”          â”‚  â”‚
â”‚    â”‚                â”‚  â”‚Thd 4â”‚ â”‚Thd 5â”‚          â”‚  â”‚
â”‚    â”‚                â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
â”‚    â”‚                â”‚                             â”‚  â”‚
â”‚    â”‚                â”‚  Each calls:                â”‚  â”‚
â”‚    â”‚                â”‚  Ollama /api/embeddings     â”‚  â”‚
â”‚    â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚    â”‚                            â”‚                   â”‚
â”‚    â”œâ”€â–º Wait for all â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚    â”‚                                                 â”‚
â”‚    â”œâ”€â–º AI Summary (sequential)                     â”‚
â”‚    â”œâ”€â–º Save to DB (parallel)                       â”‚
â”‚    â”‚                                                 â”‚
â”‚    â””â”€â–º Return Response                              â”‚
â”‚                                                      â”‚
â”‚    Trigger Async Metrics â”€â”€â”€â”€â”€â”€â”                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Spring @Async Thread Pool  â”‚
                   â”‚  (SimpleAsyncTaskExecutor)  â”‚
                   â”‚                              â”‚
                   â”‚  Background thread:          â”‚
                   â”‚  processMetricsAsync()       â”‚
                   â”‚    â”‚                         â”‚
                   â”‚    â”œâ”€â–º Discover instances   â”‚
                   â”‚    â”œâ”€â–º Fetch metrics (||)   â”‚
                   â”‚    â””â”€â–º Save to DB            â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Token Usage Optimization

```
OLD SYSTEM:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Every /healthCheck request:           â”‚
â”‚  1. Fetch logs from CloudWatch         â”‚
â”‚  2. Process logs                        â”‚
â”‚  3. Send to AI for analysis             â”‚
â”‚     â”œâ”€â–º 5000 tokens per request        â”‚
â”‚     â””â”€â–º 100 requests/day = 500K tokens â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NEW SYSTEM:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /process-logs (scheduled 15 min):     â”‚
â”‚  1. Fetch logs from CloudWatch         â”‚
â”‚  2. Process logs                        â”‚
â”‚  3. Send to AI ONCE for embeddings      â”‚
â”‚     â”œâ”€â–º 5000 tokens per run            â”‚
â”‚     â””â”€â–º 96 runs/day = 480K tokens      â”‚
â”‚  4. Cache embeddings in DynamoDB        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Embeddings stored
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /healthCheck (unlimited calls):       â”‚
â”‚  1. Read cached embeddings from DB     â”‚
â”‚  2. Use local computation               â”‚
â”‚     â”œâ”€â–º 0 AI tokens per request        â”‚
â”‚     â””â”€â–º Unlimited requests = 0 tokens  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BENEFIT:
- Old: 500K tokens for 100 health checks
- New: 480K tokens for unlimited health checks
- Savings: Can do 1000s of health checks for same cost!
```

---

## Performance Timeline

```
Time (ms)     Operation                    Thread
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0             POST /process-logs           Main
              â””â”€â–º Validate project
              
500           Fetch logs from CloudWatch   Main
              â””â”€â–º CloudWatchLogsClient
              
2500          Process & group logs         Main
              â””â”€â–º Deduplication
              
3000          Generate embeddings          Main â†’ 5 Workers
              â”œâ”€â–º Worker 1: Embed #1
              â”œâ”€â–º Worker 2: Embed #2
              â”œâ”€â–º Worker 3: Embed #3
              â”œâ”€â–º Worker 4: Embed #4
              â””â”€â–º Worker 5: Embed #5
              
6500          AI Summary                   Main
              â””â”€â–º Ollama llama3.2
              
7500          Save to DynamoDB             Main (parallel)
              â”œâ”€â–º Save summaries
              â””â”€â–º Save embeddings
              
8000          Trigger async metrics        Main â†’ Async Worker
              â””â”€â–º Return response
              
8500          [Response returned] âœ“        
              
9000          Discover EC2 instances       Async Worker
              
10000         Fetch metrics (parallel)     Async Worker
              â”œâ”€â–º Instance 1: CPU, Net
              â””â”€â–º Instance 2: CPU, Net
              
14000         Save metrics to DynamoDB     Async Worker
              
15000         [Background complete] âœ“      
```

---

These diagrams provide a comprehensive visual understanding of the system architecture, data flows, and performance characteristics. Use them for onboarding new team members, architecture reviews, and system optimization discussions.
